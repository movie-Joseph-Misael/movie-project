<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js" integrity="sha512-eHx4nbBTkIr2i0m9SANm/cczPESd0DUEcfl84JpIuutE6oDxPhXvskMR08Wmvmfx5wUpVjlWdi82G5YLvqqJdA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.rtl.min.css" integrity="sha512-tC3gnye8BsHmrW3eRP3Nrj/bs+CSVUfzkjOlfLNrfvcbKXFxk5+b8dQCZi9rgVFjDudwipXfqEhsKMMgRZGCDw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="js/index.js"></script>
    <script src="js/keys.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<!-- START SCRIPTS -->

<!-- END SCRIPTS -->
<nav class="fixed-top d-flex justify-content-center navbar p-2">
    <a href="index.html" class="p-0 navbar-brand d-none d-lg-block"
    >Movie Finder</a
    >
    <form id="search-form" class="form-inline">
        <input
                id="search"
                class="form-control mr-sm-2"
                type="search"
                placeholder="Search"
                aria-label="Search"
        />
    </form>
</nav>
<section>
    <div class="container-fluid mt-5 p-5">
        <div id="movie-content" class="row d-flex justify-content-center">
            <!-- javascript will come here -->
        </div>
    </div>
</section>
<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
        <li class="page-item">
            <a id="previous" class="btn page-link" tabindex="-1">Previous</a>
        </li>
        <li class="page-item">
            <a id="next" class="btn page-link">Next</a>
        </li>
    </ul>
</nav>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.js" integrity="sha512-nO7wgHUoWPYGCNriyGzcFwPSF+bPDOR+NvtOYy2wMcWkrnCNPKBcFEkU80XIN14UVja0Gdnff9EmydyLlOL7mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>


    let page = "1";

    const API_URL = `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=en-US&sort_by=popularity.desc&include_video=true&page=`;

    const mainContent = document.getElementById("movie-content");
    // search form elements
    const form = document.getElementById("search-form");
    const search = document.getElementById("search");
    // pagination elements
    const pageLinks = document.querySelectorAll(".page-link");
    console.log(pageLinks);

    // initially get the most popular movies list's first page
    getMovies(API_URL + page);

    // previous and next page
    pageLinks.forEach((pageLink) => {
        pageLink.addEventListener("click", () => {
            if (pageLink.id === "next") {
                page++;
                getMovies(API_URL + page);
            }
            if (pageLink.id === "previous" && page > 1) {
                page--;
                getMovies(API_URL + page);
            }
        });
    });

    // search for a movie
    form.addEventListener("submit", (e) => {
        e.preventDefault();
        console.log(search.value);
        const query = search.value;
        if (query) {
            void getMovies(API_SEARCH + query);
        }
    });

    async function getMovies(url) {
        const resp = await fetch(url);
        const respData = await resp.json();
        console.log(respData);
        console.log(respData.total_pages);
        showMovies(respData.results);
    }

    function showMovies(movies) {
        mainContent.innerHTML = "";
        movies.forEach((movie) => {
            const movieTitle = movie.title;
            const moviePoster = movie.poster_path;
            const movieVote = movie.vote_average;
            const movieElm = document.createElement("div");
            movieElm.classList.add(
                "col-xs-12",
                "col-sm-6",
                "col-md-4",
                "col-lg-3",
                "p-0"
            );
            movieElm.innerHTML = `
    <div class="movie-card">
              <img
                class="img-fluid movie-img"
                src="${IMAGE_PATH}${moviePoster}"
                onError="this.onerror=null;this.src='https://i.ebayimg.com/images/g/1EMAAMXQdGJR2-n3/s-l1600.jpg';"
                alt="Sorry, something went wrong"
              />
              <div
                class="movie-description p-3 d-flex justify-content-between align-items-center"
              >
                <h3 class="movie-title">${movieTitle}</h3>
                <h3 class="movie-vote">${movieVote}</h3>
              </div>
            </div>
    `;
            mainContent.appendChild(movieElm);
        });
    };
    window.onload = function (){
        showMovies();
    }

</script>
</body>
</html>